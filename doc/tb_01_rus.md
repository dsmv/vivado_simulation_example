# tb_01 - simple example

## Структура компонента tb

### Основные сигналы

* test_id - выбор номера теста, устанавливается из командной строки
* test_name - имена тестов
* cnt_wr, cnt_rd, cnt_ok, cnt_error - счётчики  событий теста
* in_tdata, in_tvalid, in_treadi - шина AXI Stream на входе компонента
* out_tdata, out_tvalid, out_ready - шина AXI Stream на выходе компонента
* q_data - очередь эталонных данных
* cv_all - процент покрытия code coverage

### Список task

* test_finish - вывод результата теста, вызывается по окончанию теста либо по таймауту
* set_outready_cnt - управление сигналом out_tready
* gen_out_tready - формирование последовательности out_tready
* write_data - запись одного слова
* write_seq - запись последовательности слов

### Список процессов initial

* check_timeout - заканчивает выполнение теста
* main_process - основной процесс выполнения теста
* generate_test_sequence - формирование тестовых воздействий

### Список always@(posedge clk)

* Monitor - получение данны и сравнение с эталоном из очереди q_data
* out_tready - формирование сигнала по счётчику

## Описание

Тест получает значение test_id из командной строки при помощи функции  $value$plusargs(). В зависимости от значение test_id в процессе generate_test_sequence выполняется одна из двух последовательностей. Task write_data() передаёт слово данных на шину in_tdata и это же слова записывается в очередь q_data.
Монитор получает данные по шине out_tdata и сравнивает слово со значением из очереди q_data. При совпадении увеличивается счётчик cnt_ok, при несовпадении увеличивается счётчик cnt_error. После завершении последовательнотси вызывается task test_finish в котором выводится результат выполнения. Результат выводится в консоль и в файл result.txt; В случае если тестовая последовательность не завершается то срабатывает таймаут, формируется test_timeout=1 и выполнение теста завершается.


При помощи команды bind  к проверяемомоу компоненту user_axis подключается компонент bind_user_axis. Он получает доступ ко всем сигналам компонента user_axis. Внутри bind_user_axis создаётся covergroup cvr которая собирает статистику по сигналам.

## Недостатки компонента tb

Внутри одного компонента tb собраны все необходимые процессы для тестирования:
* выбор теста
* формирование отчёта
* формирование тестовой последовательности
* очередь транзакций
* проверка результата

Переместить эти процессы в другие файлы очень затруднительно, поскольку в других файлах не будет доступа к тестируемым сигналам.

Решение этой проблемы возможно с применением пакетов и виртуальных интерфейсов. Подробнее о виртуальных интерфейсах в примере tb_02

